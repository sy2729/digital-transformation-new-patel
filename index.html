<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>New Digital Transformation Petal</title>

  <link rel="stylesheet" href="./index.css">
</head>
<body>

  <img src="./test.png"  alt="" usemap="#Map" id='petal'/>
  <map name="Map" id="Map">
      <area alt="" title="" href="http://www.google.com" shape="poly" coords="1477,409,1849,367,2193,411,1972,1235,1831,1320,1701,1240,1477,409" data-attr='digital-portfolio'/>
      <area alt="" title="" href="http://www.amazon.com" shape="poly" coords="2245,423,2582,571,2857,779,2242,1392,2094,1390,2024,1253" data-attr='client-interface'/>
      <area alt="" title="" href="http://www.youtube.com" shape="poly" coords="2898,818,3118,1115,3252,1432,2433,1655,2300,1600,2287,1429" data-attr='WFM'/>
      <area alt="" title="" href="#4" shape="poly" coords="3267,1486,3309,1831,3268,2194,2435,1974,2357,1850,2429,1707" data-attr='KM'/>
      <area alt="" title="" href="#5" shape="poly" coords="3250,2249,3128,2563,2896,2866,2288,2256,2297,2082,2430,2027" data-attr='Delivery'/>
      <area alt="" title="" href="#6" shape="poly" coords="2861,2903,2584,3114,2241,3260,2018,2426,2096,2293,2243,2286" data-attr='DWP'/>
      <area alt="" title="" href="#7" shape="poly" coords="2193,3270,1833,3315,1477,3271,1700,2437,1829,2359,1968,2436" data-attr='Internal Process'/>
      <area alt="" title="" href="#8" shape="poly" coords="1431,3260,1054,3091,813,2902,1434,2281,1574,2292,1654,2427" data-attr='Digital Marcom'/>
      <area alt="" title="" href="#9" shape="poly" coords="778,2862,532,2535,420,2249,1249,2026,1387,2105,1404,2215" 
      data-attr='Culture'/>
      <area alt="" title="" href="#10" shape="poly" coords="406,2201,358,1794,409,1490,1230,1704,1314,1821,1207,1988" data-attr='Talent'/>
      <area alt="" title="" href="#11" shape="poly" coords="418,1435,578,1071,772,820,1365,1405,1391,1585,1242,1654" data-attr='Data and Analytics'/>
      <area alt="" title="" href="#12" shape="poly" coords="817,781,1108,562,1427,426,1649,1246,1569,1396,1418,1387" data-attr='Org. and Govern.'/>
</map>

<div class="panel"></div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>

// the core function starts------------------------------------------
    var $petal;
    var areas;
    var currentWidth;
    var width;
    var original_coordinates = [];

    // calculate the map area when the page first load
    $(document).ready(function(){
       $petal = $("#petal");
       $areas = $('area')
        // $petal[0].onload=function(){
            width = $petal[0].naturalWidth;
            currentWidth = parseStyle($petal, 'width')
            calculateEachSection($areas, width, currentWidth)
        // }

        // add eventListener for Petal when being clicked on
        $areas.click((i)=>{
          i.preventDefault();
          i.stopPropagation();
          // here to input all the events for each individual petals
          let content = $(i.target).attr('data-attr')
          alert('you clicked on petal - ' + content)
          
          shrinkPetal();


        })
    })

    //recalculate the map area when resize the page
    window.addEventListener('resize', function(){
      currentWidth = parseStyle($petal, 'width')
      calculateEachSection($areas, width, currentWidth)
    })

    function calculateEachSection (nodes, width, currentWidth){
      if(original_coordinates.length === 0) {
        nodes.each((index, i)=>{
          let $eachArea = $(i);        
          let newAttr;
          let attr = $eachArea.attr('coords');
          original_coordinates.push(attr);
          newAttr = calculateCoords(attr, width, currentWidth);
          $eachArea.attr('coords', newAttr)        
        })
      }else {
        nodes.each((index, i)=>{
          let $eachArea = $(i);   
          let attr = original_coordinates[index];
          let newAttr = calculateCoords(attr, width, currentWidth); 
          $eachArea.attr('coords', newAttr)       
        })

      }
    }

    function calculateCoords (data, width, currentWidth){
      let attr = data.split(',')
      let newAttr = attr.map((i)=>{
          return (currentWidth * i) / width
        })
      newAttr = newAttr.join(', ')
      return newAttr
    }

    function parseStyle (node, property) {
      let value = node.css(property);
      value = parseFloat(value.replace(/px|%/, ''));
      return value;
    }

    // the core function ends------------------------------------------






    // maybe unnecessary
  // detect high-resolution image loading and replace the blurred one;
  let img = document.createElement('img');
  let url = './bg-clear.jpg';
  img.src = url;
  img.onload = function() {
    $('body').css('background-image', `url(${url})`)
  }


    function shrinkPetal(){
      $petal.addClass('scaled');
      $('.panel').addClass('show');
    }

    // detectPageClick
    $('body').on('touchstart mousedown', (i)=>{
      $petal.removeClass('scaled');
      $('.panel').removeClass('show');
    })
    
  </script>
</body>
</html>